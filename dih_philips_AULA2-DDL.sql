--MODULO2, SEMANA 7, AULA 2 (DDL)

CREATE TABLE USUARIO (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
    NOME VARCHAR2(128) NOT NULL,
    SOBRENOME VARCHAR2(128) NOT NULL,
    DATA_NASCIMENTO DATE NOT NULL,
    DATA_CRIACAO TIMESTAMP NOT NULL,
    PRIMARY KEY(ID)
);

CREATE TABLE POSTAGEM (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
    CONTEUDO VARCHAR2(500) NOT NULL,
    TITULO VARCHAR2(100) NOT NULL,
    DATA_CRIACAO TIMESTAMP NOT NULL,
    DATA_ATUALIZACAO TIMESTAMP NOT NULL,
    NUMERO_CURTIDAS NUMBER DEFAULT 0 NOT NULL,
    ID_USUARIO_CRIADOR NUMBER NOT NULL,
    PRIMARY KEY(ID),
    FOREIGN KEY(ID_USUARIO_CRIADOR) REFERENCES USUARIO(ID)
);

CREATE TABLE CURTIDA (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
    ID_POSTAGEM NUMBER NOT NULL,
    ID_USUARIO_CURTIDOR NUMBER NOT NULL,
    DATA_CURTIDA TIMESTAMP NOT NULL,
    PRIMARY KEY(ID),
    FOREIGN KEY(ID_POSTAGEM) REFERENCES POSTAGEM(ID),
    FOREIGN KEY(ID_USUARIO_CURTIDOR) REFERENCES USUARIO(ID)
);

CREATE TABLE AMIZADE (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
    ID_USUARIO1 NUMBER NOT NULL,
    ID_USUARIO2 NUMBER NOT NULL,
    DATA_CRIACAO TIMESTAMP NOT NULL,
    DATA_ATUALIZACAO TIMESTAMP NOT NULL,
    STATUS VARCHAR2(20) DEFAULT 'PENDENTE' NOT NULL,
    PRIMARY KEY(ID),
    FOREIGN KEY(ID_USUARIO1) REFERENCES USUARIO(ID),
    FOREIGN KEY(ID_USUARIO2) REFERENCES USUARIO(ID)
);


RENAME USUARIO TO USUARIOS;
RENAME CURTIDA TO CURTIDAS;
RENAME POSTAGEM TO POSTAGENS;
RENAME AMIZADE TO AMIZADES;


RENAME CURTIDAS TO REACOES;
ALTER TABLE POSTAGENS RENAME COLUMN NUMERO_CURTIDAS TO NUMERO_REACOES;
ALTER TABLE REACOES RENAME COLUMN ID_USUARIO_CURTIDOR TO ID_USUARIO_REATOR;
ALTER TABLE REACOES RENAME COLUMN DATA_CURTIDA TO DATA_REACAO;
ALTER TABLE USUARIOS ADD CPF VARCHAR2(11);
ALTER TABLE USUARIOS MODIFY CPF VARCHAR2(14) NOT NULL;
ALTER TABLE USUARIOS MODIFY CPF VARCHAR2(11) NULL;
ALTER TABLE USUARIOS MODIFY CPF NUMBER NOT NULL;
ALTER TABLE USUARIOS DROP COLUMN CPF;
ALTER TABLE REACOES ADD TIPO VARCHAR2(50) DEFAULT 'CURTIDA' NOT NULL;

DROP TABLE CLIENTES CASCADE CONSTRAINTS;
DROP TABLE CONTAS_CORRENTE PURGE;
DROP TABLE ENDERECOS;

SHOW RECYCLEBIN;
FLASHBACK TABLE "BIN$QKFprL3pSX2eSXqSljFgqA==$0" TO BEFORE DROP;